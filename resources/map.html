<!doctype html>
<html>
	<head>
		<title>Socket.IO chat</title>
		<style>
			* { margin: 0; padding: 0; box-sizing: border-box; }
			html { height: 100%; width: 100%; }
			body { height: 100%; width: 100%; font: 13px Helvetica, Arial; }
			#map { height: 100%; width: 100%; }
		</style>
	</head>
	<body>
		<div id="map"></div>

		<script src="/socket.io/socket.io.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script>
			function initApp() {
				var start = {lat: 41.27780646738183, lng: -90.439453125};

				var map = new google.maps.Map(document.getElementById('map'), {
					zoom: 10,
					center: start
				});

				var marker = undefined;
				var flightPath = undefined;

				var socket = io();
				var socket = io('http://127.0.0.1:3000', {reconnection: false});
				
				socket.on('marker set', function(flightPlanCoordinates) {
					marker = new google.maps.Marker({
						position: flightPlanCoordinates[0],
						map: map
					});

					flightPath = new google.maps.Polyline({
						path: flightPlanCoordinates,
						strokeColor: '#FF0000',
						strokeOpacity: 1.0,
						strokeWeight: 2
					});
					flightPath.setMap(map);

					console.log('path length', google.maps.geometry.spherical.computeLength(flightPath.getPath().getArray()));
				});	

				socket.on('marker update', function(pos) {
					console.log(pos);
					marker.setPosition(pos);
					map.panTo(pos);
				});
			};
		</script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDwYLNufQwCTo_JQomB9Q3IUTrErUln3k&callback=initApp&libraries=geometry"></script>
	</body>
</html>